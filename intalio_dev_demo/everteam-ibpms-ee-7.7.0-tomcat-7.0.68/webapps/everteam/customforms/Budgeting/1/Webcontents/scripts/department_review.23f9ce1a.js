$(function(){var a=new WorkflowClient;a.token||$("#tokenProblem").modal();var b=_.template($("#project-template").html()),c=a.getTask(),d={};c.then(function(a){d=a["tms:getTaskResponse"]["tms:task"]["tms:input"];var c=d.ProjectDepartmentIdentifier,e=c.DepartmentId.$,f=c.ExcerciseId.$,g=function(a,b,c,d,g){$.ajax({type:"POST",url:"/intalio/ode/processes/Budgeting/Processes/Integrations/ProjectReviewAPI/process/caller",data:JSON.stringify({"proc:update_projectRequest":{"@xmlns":{proc:"http://budgeting.example.everteam.com/Processes/Integrations/ProjectReviewAPI/process",bus:"http://budgeting.example.everteam.com/Types/Business",tec:"http://budgeting.example.everteam.com/Types/Technical"},"tec:project":{"bus:ExcerciseId":{$:f},"bus:DepartmentId":{$:e},"bus:ProjectId":{$:a}},"tec:budget":{$:b},"tec:priority":{$:c},"tec:included":{$:d+""},"tec:approved":{$:"true"}}}),headers:{"Content-Type":"application/json/badgerfish"},error:function(a,b,c){console.log(c)},success:g})},h=function(a){var b=a.parents("tr"),c=b.data()["Technical:ProjectId"].$,d=b.find("input[type='text']").val(),e=b.find("select").val(),f=b.find("input[type='checkbox']").is(":checked")?"true":"false";$("#submit").prop("disabled",!0).text("Loading"),g(c,d,e,f,function(){$("#submit").prop("disabled",!1).text("Submit")})};$.ajax({type:"POST",url:"/intalio/ode/processes/Budgeting/Processes/Integrations/ProjectReviewAPI/process/caller",data:JSON.stringify({"proc:Get_projectsRequest":{"@xmlns":{proc:"http://budgeting.example.everteam.com/Processes/Integrations/ProjectReviewAPI/process",bus:"http://budgeting.example.everteam.com/Types/Business"},"bus:DepartmentId":{$:e},"bus:ExcerciseId":{$:f}}}),headers:{"Content-Type":"application/json/badgerfish"},success:function(a){response=a.Get_projectsResponse,$("#department_name").text(response["Technical:Dapartment"]["tns:DeparmentName"].$),$("#fiscal_year").text(response["Technical:Variables"]["tns:fiscal_year"].$),$("#expected_increase").text(response["Technical:Variables"]["tns:ExpectedIncrease"].$),$("#new_investements").text(response["Technical:Variables"]["tns:new_investements"].$),$("#target_approval_date").text(response["Technical:Variables"]["tns:TargetApproval"].$),$("#target_expenses").text(response["Technical:Variables"]["tns:target_expenses"].$),$("#target_submission").text(response["Technical:Variables"]["tns:TargetSubmision"].$),$.isArray(response["Technical:ReviewProjects"])||(response["Technical:ReviewProjects"]=[response["Technical:ReviewProjects"]]),$.each(response["Technical:ReviewProjects"],function(a,c){c["Technical:ProjectAttachments"]["Technical:attachment"]&&!$.isArray(c["Technical:ProjectAttachments"]["Technical:attachment"])&&(c["Technical:ProjectAttachments"]["Technical:attachment"]=[c["Technical:ProjectAttachments"]["Technical:attachment"]]);var d={projectName:c["Technical:Project"]["tns:ProjectName"].$,targetBudget:c["Technical:Project"]["tns:TargetBudget"].$,projectNotes:c["Technical:Project"]["tns:Notes"].$,requested_budget:c["Technical:Requirements"]["tns:Budget"].$,new_project:c["Technical:Requirements"]["tns:NewProject"].$,last_year:c["Technical:Requirements"]["tns:LastYearBudget"].$,description:c["Technical:Requirements"]["tns:Description"].$,justification:c["Technical:Requirements"]["tns:Justification"].$,priority:c["Technical:Requirements"]["tns:Priority"].$,attachments:_.map(c["Technical:ProjectAttachments"]["Technical:attachment"],function(a){return{url:a["Technical:payloadUrl"].$,title:a["Technical:title"].$}})},e=$(b({data:d}));e.data(c),e.find("input[type='checkbox']").bootstrapSwitch({size:"mini",onSwitchChange:function(){var a=$(this);h(a),a.parents("tr").toggleClass("success").toggleClass("danger")}}),e.find("input[type='text']").change(function(){var a=$(this);h(a)}),e.find("select").change(function(){var a=$(this);h(a)}),$("#projects").append(e)})},error:function(a,b,c){console.log(c)}})},function(a){console.log(a)}),$("#submit").click(function(){a.completeTask(d)})});
<?xml version="1.0" encoding="UTF-8"?>

<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:mvc="http://www.springframework.org/schema/mvc"
	xmlns:context="http://www.springframework.org/schema/context" xmlns:tx="http://www.springframework.org/schema/tx"
	xsi:schemaLocation="http://www.springframework.org/schema/beans
    http://www.springframework.org/schema/beans/spring-beans-3.1.xsd
    http://www.springframework.org/schema/mvc
    http://www.springframework.org/schema/mvc/spring-mvc-3.1.xsd
    http://www.springframework.org/schema/tx
	http://www.springframework.org/schema/tx/spring-tx.xsd
    http://www.springframework.org/schema/context
	http://www.springframework.org/schema/context/spring-context-3.1.xsd">

	<context:component-scan base-package="com.intalio.bpms.adhocreport">
		<context:exclude-filter type="annotation"
			expression="org.springframework.stereotype.Controller" />
	</context:component-scan>

	<tx:annotation-driven transaction-manager="adhocreport.transactionManager" />

	<import resource="file:${INTALIO_CONF}/hibernate/hibernate-properties.xml" />
	<import
		resource="file:${INTALIO_CONF}/adhocreport/adhocreport-access-control.xml" />

	<bean id="adhocreport.dataSource" class="org.springframework.jndi.JndiObjectFactoryBean">
		<property name="jndiName">
			<value>${com.intalio.bpms.jndi.bpmsdb}</value>
		</property>
	</bean>

	<bean id="adhocreport.sessionFactory"
		class="org.springframework.orm.hibernate3.annotation.AnnotationSessionFactoryBean">
		<property name="dataSource">
			<ref local="adhocreport.dataSource" />
		</property>
		<property name="annotatedClasses">
			<list>
				<value>com.intalio.bpms.adhocreport.model.Report</value>
				<value>com.intalio.bpms.adhocreport.model.ReportAccess</value>
				<value>com.intalio.bpms.console.model.ModuleAction</value>
				<value>com.intalio.bpms.console.model.ModuleActionAccess</value>
			</list>
		</property>
		<property name="hibernateProperties" ref="hibernateProperties" />
	</bean>

	<!-- Hibernate Transaction Manager Definition -->
	<bean id="adhocreport.transactionManager"
		class="org.springframework.orm.hibernate3.HibernateTransactionManager">
		<property name="sessionFactory">
			<ref local="adhocreport.sessionFactory" />
		</property>
	</bean>

	<bean id="adhocreport.reportDAO" class="com.intalio.bpms.adhocreport.dao.ReportDAO">
		<property name="sessionFactory" ref="adhocreport.sessionFactory" />
	</bean>

	<bean id="adhocreport.utilityService"
		class="com.intalio.bpms.adhocreport.service.impl.UtilityService">
		<property name="reportAdminRoles" ref="reportAdminRoles" />
		<property name="maxPreviewRows" value="${com.intalio.bam.report.max.rows.preview}" />
		<property name="previewTimeout" value="${com.intalio.bam.report.timeout.preview}" />
		<property name="executionTimeout" value="${com.intalio.bam.report.timeout.execution}" />
	</bean>

	<bean id="adhocreport.jdbcExceptionTranslator"
		class="org.springframework.jdbc.support.SQLErrorCodeSQLExceptionTranslator">
		<property name="dataSource">
			<ref bean="adhocreport.dataSource" />
		</property>
	</bean>

	<bean id="adhocreport.hibernateTemplate" class="org.springframework.orm.hibernate3.HibernateTemplate">
		<property name="sessionFactory">
			<ref bean="adhocreport.sessionFactory" />
		</property>
		<property name="jdbcExceptionTranslator">
			<ref bean="adhocreport.jdbcExceptionTranslator" />
		</property>
	</bean>

	<bean id="console.accessDao" class="com.intalio.bpms.console.dao.AccessDao">
		<property name="hibernateTemplate">
			<ref bean="adhocreport.hibernateTemplate" />
		</property>
	</bean>

	<bean id="console.accessService" class="com.intalio.bpms.console.service.AccessService" />
</beans>
<?xml version="1.0" encoding="UTF-8"?>

<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:context="http://www.springframework.org/schema/context"
	xmlns:tx="http://www.springframework.org/schema/tx" xmlns:aop="http://www.springframework.org/schema/aop"
	xmlns:util="http://www.springframework.org/schema/util"
	xsi:schemaLocation="http://www.springframework.org/schema/beans
    http://www.springframework.org/schema/beans/spring-beans-3.1.xsd
    http://www.springframework.org/schema/context
	http://www.springframework.org/schema/context/spring-context-3.1.xsd
	http://www.springframework.org/schema/tx
	http://www.springframework.org/schema/tx/spring-tx.xsd
	http://www.springframework.org/schema/aop
	http://www.springframework.org/schema/aop/spring-aop-3.1.xsd
	http://www.springframework.org/schema/util
	http://www.springframework.org/schema/util/spring-util-3.1.xsd">

	<context:property-placeholder
		location="file:${INTALIO_CONF}/common/base-config.properties" order="1"
		ignore-unresolvable="false" />

	<context:component-scan base-package="com.intalio.bpms.pdfgen">
	</context:component-scan>

	<context:annotation-config />

	<tx:annotation-driven transaction-manager="pdfgen.transactionManager" />

	<bean id="pdfgen.storageStrategyProvider" class="com.intalio.bpms.pdfgen.storage.StorageStrategyProvider">
		<property name="storageStrategy">
			<value>${com.intalio.bpms.pdf.storage}</value>
		</property>
		<property name="holderMap">
			<map>
				<entry key="database" value-ref="pdfgen.dbStorageStrategy" />
				<entry key="filesystem" value-ref="pdfgen.fsStorageStrategy" />
		<!--Any custom storage strategy can be plugged in by adding the implementation class here -->
		<!--			<entry key="anyCustomKey" value-ref="customImplementation" />             -->
			</map>
		</property>
	</bean>

	<bean id="pdfgen.dbStorageStrategy" class="com.intalio.bpms.pdfgen.storage.DatabaseStorageStrategy">
		<property name="pdfStoreEndpoint">
			<value>http://${com.intalio.bpms.server.baseUrl}/everteam/pdfgen/</value>
		</property>
		<property name="pdfDao">
			<ref local="pdfgen.pdfDao" />
		</property>
	</bean>

	<bean id="pdfgen.fsStorageStrategy" class="com.intalio.bpms.pdfgen.storage.FileSystemStorageStrategy">
		<property name="pdfStoreEndpoint">
			<value>http://${com.intalio.bpms.server.baseUrl}/everteam/pdfgen/</value>
		</property>
		<property name="pdfStoreFolder">
			<value>${com.intalio.bpms.pdf.storage.filesystem.pdfDir}
			</value>
		</property>
	</bean>


	<bean id="pdfgen.pdfDao" class="com.intalio.bpms.pdfgen.dao.PDFDao">
		<property name="hibernateTemplate">
			<ref bean="pdfgen.hibernateTemplate" />
		</property>
	</bean>


	<!-- Hibernate Template Defintion -->
	<bean id="pdfgen.hibernateTemplate" class="org.springframework.orm.hibernate3.HibernateTemplate">
		<property name="sessionFactory">
			<ref bean="pdfgen.sessionFactory" />
		</property>
		<property name="jdbcExceptionTranslator">
			<ref bean="pdfgen.jdbcExceptionTranslator" />
		</property>
	</bean>

	<bean id="pdfgen.sessionFactory"
		class="org.springframework.orm.hibernate3.annotation.AnnotationSessionFactoryBean">
		<property name="dataSource">
			<ref local="pdfgen.dataSource" />
		</property>
		<property name="annotatedClasses">
			<list>
				<value>com.intalio.bpms.pdfgen.model.PDFData</value>
			</list>
		</property>
		<property name="hibernateProperties" ref="hibernateProperties" />
	</bean>

	<bean id="pdfgen.dataSource" class="org.springframework.jndi.JndiObjectFactoryBean">
		<property name="jndiName">
			<value>${com.intalio.bpms.jndi.bpmsdb}</value>
		</property>
	</bean>

	<!-- Spring Data Access Exception Translator Defintion -->
	<bean id="pdfgen.jdbcExceptionTranslator"
		class="org.springframework.jdbc.support.SQLErrorCodeSQLExceptionTranslator">
		<property name="dataSource">
			<ref bean="pdfgen.dataSource" />
		</property>
	</bean>

	<bean id="pdfgen.transactionManager"
		class="org.springframework.transaction.jta.JtaTransactionManager">
		<property name="transactionManagerName" value="${com.intalio.bpms.jndi.txmanager}" />
		<property name="userTransactionName" value="${com.intalio.bpms.jndi.usertx}" />
	</bean>

</beans>
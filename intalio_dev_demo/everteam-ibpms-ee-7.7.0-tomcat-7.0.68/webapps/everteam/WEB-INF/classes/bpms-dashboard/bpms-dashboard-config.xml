<?xml version="1.0" encoding="UTF-8"?>

<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:context="http://www.springframework.org/schema/context"
	xmlns:mvc="http://www.springframework.org/schema/mvc"
	xmlns:tx="http://www.springframework.org/schema/tx"
	xsi:schemaLocation="http://www.springframework.org/schema/beans
    http://www.springframework.org/schema/beans/spring-beans-3.1.xsd
    http://www.springframework.org/schema/mvc
    http://www.springframework.org/schema/mvc/spring-mvc-3.1.xsd
    http://www.springframework.org/schema/tx
	http://www.springframework.org/schema/tx/spring-tx.xsd
    http://www.springframework.org/schema/context
	http://www.springframework.org/schema/context/spring-context-3.1.xsd">

	<tx:annotation-driven transaction-manager="dashboard.transactionManager" />
	<import resource="file:${INTALIO_CONF}/hibernate/hibernate-properties.xml" />
	<bean id="dashboard.messageSource"
		class="org.springframework.context.support.ResourceBundleMessageSource">
		<property name="basenames">
			<list>
				<value>bpms-dashboard/dashboard-messages</value>
			</list>
		</property>
	</bean>

	<bean id="dashboard.dataSource" class="org.springframework.jndi.JndiObjectFactoryBean">
		<property name="jndiName">
			<value>${com.intalio.bpms.jndi.bpmsdb}</value>
		</property>
	</bean>

	<bean id="dashboard.sessionFactory"
		class="org.springframework.orm.hibernate3.annotation.AnnotationSessionFactoryBean">
		<property name="dataSource">
			<ref local="dashboard.dataSource" />
		</property>
		<property name="annotatedClasses">
			<list>
				<value>com.intalio.bpms.dashboard.model.DashboardState</value>
			</list>
		</property>
		<property name="hibernateProperties" ref="hibernateProperties" />
	</bean>

	<!-- Spring Data Access Exception Translator Defintion -->
	<bean id="dashboard.jdbcExceptionTranslator"
		class="org.springframework.jdbc.support.SQLErrorCodeSQLExceptionTranslator">
		<property name="dataSource">
			<ref bean="dashboard.dataSource" />
		</property>
	</bean>

	<!-- Hibernate Template Defintion -->
	<bean id="dashboard.hibernateTemplate" class="org.springframework.orm.hibernate3.HibernateTemplate">
		<property name="sessionFactory">
			<ref bean="dashboard.sessionFactory" />
		</property>
		<property name="jdbcExceptionTranslator">
			<ref bean="dashboard.jdbcExceptionTranslator" />
		</property>
	</bean>

	<bean id="dashboard.transactionManager"
		class="org.springframework.transaction.jta.JtaTransactionManager">
		<property name="transactionManagerName" value="${com.intalio.bpms.jndi.txmanager}" />
		<property name="userTransactionName" value="${com.intalio.bpms.jndi.usertx}" />
	</bean>

	<bean id="dashboard.stateDao" class="com.intalio.bpms.dashboard.dao.DashboardStateDAOImpl">
		<property name="hibernateTemplate">
			<ref bean="dashboard.hibernateTemplate" />
		</property>
	</bean>

	<bean id="tms.taskDAOFactory" class="org.intalio.tempo.workflow.tms.server.dao.JPATaskDaoConnectionFactory"
		parent="abs.AbstractJPAConnectionFactory" />

	<bean id="tms.vacationDAOConnectionFactory" class="org.intalio.tempo.workflow.tms.server.dao.JPAVacationDAOConnectionFactory"
		parent="abs.AbstractJPAConnectionFactory" />

	<bean id="dashboard.stateController"
		class="com.intalio.bpms.dashboard.data.controller.DashboardStateController">
		<constructor-arg>
			<ref bean="dashboard.stateDao" />
		</constructor-arg>
	</bean>

	<bean id="dashboard.dataController"
		class="com.intalio.bpms.dashboard.data.controller.DashboardDataController">
		<property name="loginController">
		  <ref bean="loginController" />
		</property>
		<property name="sessionTimeout" value="${com.intalio.bpms.timeout.session}" />
		<property name="vacationDAOConnectionFactory">
		  <ref bean="tms.vacationDAOConnectionFactory" />
		</property>
	</bean>

	<bean id="security.rbacQueryClient" class="org.intalio.tempo.security.ws.RBACQueryClient">
		<constructor-arg value="http://${com.intalio.bpms.server.baseUrl}/${com.intalio.bpms.endpoint.rbacquery-service}" />
	</bean>

</beans>

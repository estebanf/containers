<?xml version="1.0" encoding="UTF-8"?>
<!-- Copyright (C) 2016, Ever Team Software The program(s) herein may be used and/or copied
	 only with the written permission of Ever Team Software or in accordance with the terms 
	 and conditions stipulated in the agreement/contract under which the program(s) have been 
	 supplied. -->
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:mvc="http://www.springframework.org/schema/mvc" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:p="http://www.springframework.org/schema/p" xmlns:tx="http://www.springframework.org/schema/tx"
	xmlns:context="http://www.springframework.org/schema/context"
	xsi:schemaLocation="http://www.springframework.org/schema/beans
	http://www.springframework.org/schema/beans/spring-beans-3.2.xsd
	http://www.springframework.org/schema/context
	http://www.springframework.org/schema/context/spring-context-3.2.xsd
	http://www.springframework.org/schema/mvc
	http://www.springframework.org/schema/mvc/spring-mvc-3.2.xsd
	http://www.springframework.org/schema/tx
	http://www.springframework.org/schema/tx/spring-tx-3.2.xsd">
	<context:property-placeholder
		location="file:${INTALIO_CONF}/common/base-config.properties" order="1"
		ignore-unresolvable="false" />
	<import resource="file:${INTALIO_CONF}/hibernate/hibernate-properties.xml" />
	<context:component-scan base-package="com.intalio.bpms.webmodeler" />
	<context:annotation-config />
	<tx:annotation-driven transaction-manager="webmodeler.transactionManager" />
	<mvc:annotation-driven>
		<mvc:argument-resolvers>
			<bean
				class="com.intalio.bpms.webmodeler.utils.SessionAttributeArgumentResolver" />
		</mvc:argument-resolvers>
	</mvc:annotation-driven>
	<bean id="webmodeler.dataSource" class="org.springframework.jndi.JndiObjectFactoryBean">
		<property name="jndiName">
			<value>${com.intalio.bpms.jndi.bpmsdb}</value>
		</property>
	</bean>
	<bean class="org.springframework.web.servlet.view.ContentNegotiatingViewResolver">
	  <property name="mediaTypes">
	    <map>
	      <entry key="html" value="text/html"/>
	      <entry key="json" value="application/json"/>
	    </map>
	  </property>
	  <property name="viewResolvers">
	    <list>
	      <bean class="org.springframework.web.servlet.view.UrlBasedViewResolver">
	        <property name="viewClass" value="org.springframework.web.servlet.view.JstlView"/>
	        <property name="prefix" value="/WEB-INF/jsp/"/>
	        <property name="suffix" value=".jsp"/>
	      </bean>
	    </list>
	  </property>
	  <property name="defaultViews">
	    <list>
	      <bean class="org.springframework.web.servlet.view.json.MappingJacksonJsonView">
	        <property name="prefixJson" value="true"/>
	      </bean>
	    </list>
	  </property>
	</bean>

	<bean id="multipartResolver"
		class="org.springframework.web.multipart.commons.CommonsMultipartResolver">
		<!-- one of the properties available; the maximum file size in bytes -->
		<property name="maxUploadSize" value="${com.intalio.bpms.upload.max-file-size}" />
	</bean>

	<bean id="webmodeler.sessionFactory"
		class="org.springframework.orm.hibernate3.annotation.AnnotationSessionFactoryBean">
		<property name="dataSource">
			<ref local="webmodeler.dataSource" />
		</property>
		<property name="annotatedClasses">
			<list>
				<value>com.intalio.bpms.webmodeler.model.Diagram</value>
				<value>com.intalio.bpms.webmodeler.model.DiagramAccess</value>
				<value>com.intalio.bpms.webmodeler.model.DiagramObject</value>
				<value>com.intalio.bpms.webmodeler.model.DiagramObjectProperty</value>
				<value>com.intalio.bpms.webmodeler.model.AttachmentData</value>
			</list>
		</property>
		<property name="hibernateProperties" ref="hibernateProperties" />
	</bean>
	<!-- Hibernate Transaction Manager Definition -->
	<bean id="webmodeler.transactionManager"
		class="org.springframework.orm.hibernate3.HibernateTransactionManager">
		<property name="sessionFactory">
			<ref local="webmodeler.sessionFactory" />
		</property>
	</bean>
	<bean id="webmodeler.diagramDAO" class="com.intalio.bpms.webmodeler.dao.DiagramDAOImpl">
		<property name="sessionFactory">
			<ref bean="webmodeler.sessionFactory" />
		</property>
	</bean>
	<bean id="webmodeler.diagramObjectPropertyDAO" class="com.intalio.bpms.webmodeler.dao.DiagramObjectPropertyDAOImpl">
		<property name="sessionFactory">
			<ref bean="webmodeler.sessionFactory" />
		</property>
	</bean>
	<bean id="webmodeler.messageSource"
		class="org.springframework.context.support.ResourceBundleMessageSource">
		<property name="basenames">
			<list>
				<value>bpms-webmodeler/webmodeler-messages</value>
			</list>
		</property>
	</bean>
	<bean id="webmodeler.configuration" class="com.intalio.bpms.webmodeler.Configuration">
		<property name="autoSaveEnabled">
			<value>${com.intalio.bpms.webmodeler.autosave}</value>
		</property>
		<property name="autoSaveInterval">
			<value>${com.intalio.bpms.webmodeler.autosave.interval}</value>
		</property>
	</bean>
</beans>
